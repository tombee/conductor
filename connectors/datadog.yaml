# Datadog Connector Package
# Official connector for Datadog Logs, Metrics, and Events APIs

version: "1.0"
name: datadog
description: Datadog observability platform connector for logs, metrics, and events

# Base URL is dynamically determined by site configuration:
# - Logs: https://http-intake.logs.{site}
# - Metrics/Events: https://api.{site}
# Default site: datadoghq.com
# Supported sites: datadoghq.com, us3.datadoghq.com, us5.datadoghq.com, datadoghq.eu, ap1.datadoghq.com

# Datadog API rate limits vary by endpoint
# Conservative defaults for logs/metrics
rate_limit:
  requests_per_second: 10
  requests_per_minute: 500

operations:
  # Logs API
  log:
    method: POST
    path: /api/v2/logs
    # Base URL override: https://http-intake.logs.{site}
    request_schema:
      type: object
      properties:
        message:
          type: string
          description: Log message content
        status:
          type: string
          description: Log level (debug, info, warn, error, critical)
          enum: [debug, info, warn, error, critical]
        service:
          type: string
          description: Service name (overrides default_service)
        source:
          type: string
          description: Log source / ddsource (overrides default_source)
        tags:
          type: array
          description: Array of tags in key:value format
          items:
            type: string
        attributes:
          type: object
          description: Structured data / custom attributes
        hostname:
          type: string
          description: Override auto-detected hostname
        timestamp:
          type: integer
          description: Unix timestamp in seconds (auto-populated if omitted)
      required: [message]
    response_transform: "{status, logs_accepted: 1}"

  # Metrics API
  metric:
    method: POST
    path: /api/v2/series
    # Base URL override: https://api.{site}
    request_schema:
      type: object
      properties:
        metric:
          type: string
          description: Metric name (for single metric submission)
        type:
          type: string
          description: Metric type (gauge, count, rate)
          enum: [gauge, count, rate]
        value:
          type: number
          description: Metric value (for single metric submission)
        tags:
          type: array
          description: Array of metric tags in key:value format
          items:
            type: string
        timestamp:
          type: integer
          description: Unix timestamp in seconds (auto-populated if omitted)
        unit:
          type: string
          description: Metric unit for documentation
        interval:
          type: integer
          description: For rate metrics, the interval in seconds
        series:
          type: array
          description: Array of metric objects for batch submission
          items:
            type: object
            properties:
              metric:
                type: string
              type:
                type: string
                enum: [gauge, count, rate]
              value:
                type: number
              tags:
                type: array
                items:
                  type: string
              timestamp:
                type: integer
              unit:
                type: string
              interval:
                type: integer
            required: [metric, value]
      # Either single metric (metric + value) or batch (series) required
    response_transform: "{status, metrics_accepted: (.series | length)}"

  # Events API
  event:
    method: POST
    path: /api/v1/events
    # Base URL override: https://api.{site}
    request_schema:
      type: object
      properties:
        title:
          type: string
          description: Event title
        text:
          type: string
          description: Event description (supports Markdown)
        priority:
          type: string
          description: Event priority (normal, low)
          enum: [normal, low]
        alert_type:
          type: string
          description: Event type (info, warning, error, success)
          enum: [info, warning, error, success]
        tags:
          type: array
          description: Array of event tags in key:value format
          items:
            type: string
        aggregation_key:
          type: string
          description: Key for grouping related events
        source_type_name:
          type: string
          description: Source type (e.g., "conductor")
        host:
          type: string
          description: Override auto-detected hostname
        date_happened:
          type: integer
          description: Unix timestamp in seconds (auto-populated if omitted)
      required: [title, text]
    response_transform: "{status, event_id: .event.id}"
