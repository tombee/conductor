# Slack Connector Package
# Official connector for Slack Web API integration

version: "1.0"
name: slack
description: Slack Web API connector for messages, channels, and users

base_url: https://slack.com/api

# Slack API tier 3 rate limits (50+ requests per minute)
# Conservative default
rate_limit:
  requests_per_second: 1
  requests_per_minute: 50

operations:
  # Messages
  post_message:
    method: POST
    path: /chat.postMessage
    request_schema:
      type: object
      properties:
        channel:
          type: string
          description: Channel ID or name (e.g., "#general" or "C1234567890")
        text:
          type: string
          description: Message text (supports mrkdwn formatting)
        blocks:
          type: array
          description: Block Kit blocks for rich formatting
        thread_ts:
          type: string
          description: Thread timestamp to reply to
        icon_emoji:
          type: string
          description: Emoji to use as icon (e.g., ":robot_face:")
        icon_url:
          type: string
          description: URL to image for icon
        username:
          type: string
          description: Bot username override
      required: [channel, text]
    response_transform: "{ok, ts, channel, message: {text, ts}}"

  update_message:
    method: POST
    path: /chat.update
    request_schema:
      type: object
      properties:
        channel:
          type: string
        ts:
          type: string
          description: Message timestamp to update
        text:
          type: string
          description: New message text
        blocks:
          type: array
          description: New Block Kit blocks
      required: [channel, ts, text]
    response_transform: "{ok, ts, channel}"

  delete_message:
    method: POST
    path: /chat.delete
    request_schema:
      type: object
      properties:
        channel:
          type: string
        ts:
          type: string
          description: Message timestamp to delete
      required: [channel, ts]
    response_transform: "{ok, channel, ts}"

  add_reaction:
    method: POST
    path: /reactions.add
    request_schema:
      type: object
      properties:
        channel:
          type: string
        timestamp:
          type: string
          description: Message timestamp
        name:
          type: string
          description: Emoji name (without colons, e.g., "thumbsup")
      required: [channel, timestamp, name]
    response_transform: "{ok}"

  # Files
  upload_file:
    method: POST
    path: /files.upload
    request_schema:
      type: object
      properties:
        channels:
          type: string
          description: Comma-separated list of channel IDs
        content:
          type: string
          description: File content (for text files)
        filename:
          type: string
          description: Filename
        filetype:
          type: string
          description: File type identifier
        initial_comment:
          type: string
          description: Initial message to post with file
        title:
          type: string
          description: Title of file
        thread_ts:
          type: string
          description: Thread timestamp to upload to
      required: [channels, content, filename]
    response_transform: "{ok, file: {id, name, title, permalink}}"

  # Channels
  list_channels:
    method: GET
    path: /conversations.list
    request_schema:
      type: object
      properties:
        types:
          type: string
          description: Channel types (comma-separated, e.g., "public_channel,private_channel")
        exclude_archived:
          type: boolean
          description: Exclude archived channels
        limit:
          type: integer
          description: Maximum channels to return
        cursor:
          type: string
          description: Pagination cursor
      required: []
    response_transform: "{ok, channels: [.channels[] | {id, name, is_channel, is_private, is_archived, num_members}]}"

  create_channel:
    method: POST
    path: /conversations.create
    request_schema:
      type: object
      properties:
        name:
          type: string
          description: Channel name (lowercase, no spaces)
        is_private:
          type: boolean
          description: Create as private channel
      required: [name]
    response_transform: "{ok, channel: {id, name, is_channel, is_private}}"

  invite_to_channel:
    method: POST
    path: /conversations.invite
    request_schema:
      type: object
      properties:
        channel:
          type: string
          description: Channel ID
        users:
          type: string
          description: Comma-separated list of user IDs
      required: [channel, users]
    response_transform: "{ok, channel: {id, name}}"

  # Users
  list_users:
    method: GET
    path: /users.list
    request_schema:
      type: object
      properties:
        limit:
          type: integer
          description: Maximum users to return
        cursor:
          type: string
          description: Pagination cursor
      required: []
    response_transform: "{ok, members: [.members[] | {id, name, real_name, is_bot, is_admin, tz}]}"

  get_user:
    method: GET
    path: /users.info
    request_schema:
      type: object
      properties:
        user:
          type: string
          description: User ID
      required: [user]
    response_transform: "{ok, user: {id, name, real_name, email: .profile.email, is_bot, is_admin, tz}}"
