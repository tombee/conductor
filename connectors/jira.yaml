# Jira Connector Package
# Official connector for Jira REST API integration
# Compatible with Jira Cloud and Jira Server/Data Center

version: "1.0"
name: jira
description: Jira REST API connector for issues, projects, and workflows

# Note: base_url must be overridden by user (e.g., https://mycompany.atlassian.net)
# This placeholder is replaced when the connector is imported
base_url: https://your-domain.atlassian.net

# Default headers for Jira API
headers:
  Content-Type: "application/json"

# Jira Cloud rate limits vary by plan
# Conservative default to avoid hitting limits
rate_limit:
  requests_per_second: 5
  requests_per_minute: 100

operations:
  # Issues
  create_issue:
    method: POST
    path: /rest/api/3/issue
    request_schema:
      type: object
      properties:
        project:
          type: object
          properties:
            key:
              type: string
              description: Project key (e.g., "PROJ")
          required: [key]
        summary:
          type: string
          description: Issue summary/title
        description:
          type: string
          description: Issue description (supports Jira markup)
        issuetype:
          type: object
          properties:
            name:
              type: string
              description: Issue type (e.g., "Bug", "Task", "Story")
          required: [name]
        priority:
          type: object
          properties:
            name:
              type: string
              description: Priority name (e.g., "High", "Medium", "Low")
        labels:
          type: array
          items:
            type: string
          description: Issue labels
        assignee:
          type: object
          properties:
            accountId:
              type: string
              description: User account ID
      required: [project, summary, issuetype]
    response_transform: "{id, key, self}"

  update_issue:
    method: PUT
    path: /rest/api/3/issue/{issue_key}
    request_schema:
      type: object
      properties:
        issue_key:
          type: string
          description: Issue key (e.g., "PROJ-123")
        summary:
          type: string
        description:
          type: string
        priority:
          type: object
          properties:
            name:
              type: string
        labels:
          type: array
          items:
            type: string
        assignee:
          type: object
          properties:
            accountId:
              type: string
      required: [issue_key]
    response_transform: "{}"

  get_issue:
    method: GET
    path: /rest/api/3/issue/{issue_key}
    request_schema:
      type: object
      properties:
        issue_key:
          type: string
        fields:
          type: string
          description: Comma-separated list of fields to return
        expand:
          type: string
          description: Additional data to expand
      required: [issue_key]
    response_transform: "{id, key, self, fields: {summary, description, status: .fields.status.name, assignee: .fields.assignee.displayName, priority: .fields.priority.name, created: .fields.created, updated: .fields.updated}}"

  transition_issue:
    method: POST
    path: /rest/api/3/issue/{issue_key}/transitions
    request_schema:
      type: object
      properties:
        issue_key:
          type: string
        transition:
          type: object
          properties:
            id:
              type: string
              description: Transition ID
          required: [id]
        comment:
          type: string
          description: Optional comment with transition
      required: [issue_key, transition]
    response_transform: "{}"

  get_transitions:
    method: GET
    path: /rest/api/3/issue/{issue_key}/transitions
    request_schema:
      type: object
      properties:
        issue_key:
          type: string
      required: [issue_key]
    response_transform: "{transitions: [.transitions[] | {id, name, to: {name: .to.name}}]}"

  # Comments
  add_comment:
    method: POST
    path: /rest/api/3/issue/{issue_key}/comment
    request_schema:
      type: object
      properties:
        issue_key:
          type: string
        body:
          type: string
          description: Comment text (supports Jira markup)
      required: [issue_key, body]
    response_transform: "{id, self, created, updated}"

  # Assignment
  assign_issue:
    method: PUT
    path: /rest/api/3/issue/{issue_key}/assignee
    request_schema:
      type: object
      properties:
        issue_key:
          type: string
        accountId:
          type: string
          description: User account ID (use null or -1 to unassign)
      required: [issue_key, accountId]
    response_transform: "{}"

  # Search
  search_issues:
    method: GET
    path: /rest/api/3/search
    request_schema:
      type: object
      properties:
        jql:
          type: string
          description: JQL query string (e.g., "project = PROJ AND status = Open")
        startAt:
          type: integer
          description: Starting index for pagination
        maxResults:
          type: integer
          description: Maximum results to return (max 100)
        fields:
          type: string
          description: Comma-separated list of fields
      required: [jql]
    response_transform: "{total, issues: [.issues[] | {key, summary: .fields.summary, status: .fields.status.name, assignee: .fields.assignee.displayName}]}"

  # Projects
  list_projects:
    method: GET
    path: /rest/api/3/project
    request_schema:
      type: object
      properties:
        recent:
          type: integer
          description: Number of recent projects to return
        expand:
          type: string
          description: Additional data to expand
      required: []
    response_transform: "[.[] | {id, key, name, projectTypeKey, self}]"

  # Attachments
  add_attachment:
    method: POST
    path: /rest/api/3/issue/{issue_key}/attachments
    headers:
      X-Atlassian-Token: "no-check"
    request_schema:
      type: object
      properties:
        issue_key:
          type: string
        filename:
          type: string
          description: Attachment filename
        content:
          type: string
          description: Base64-encoded file content
      required: [issue_key, filename, content]
    response_transform: "[.[] | {id, filename, size, created}]"

  # Issue Links
  link_issues:
    method: POST
    path: /rest/api/3/issueLink
    request_schema:
      type: object
      properties:
        type:
          type: object
          properties:
            name:
              type: string
              description: Link type (e.g., "Blocks", "Relates")
          required: [name]
        inwardIssue:
          type: object
          properties:
            key:
              type: string
          required: [key]
        outwardIssue:
          type: object
          properties:
            key:
              type: string
          required: [key]
        comment:
          type: string
          description: Optional comment
      required: [type, inwardIssue, outwardIssue]
    response_transform: "{}"
