name: custom-tools-example
description: Example workflow demonstrating custom HTTP and script functions for LLM use

# Define LLM-callable functions at workflow level (renamed from 'tools')
functions:
  # HTTP tool for API integration
  - name: get_weather
    type: http
    description: "Fetch current weather for a city"
    method: GET
    url: "https://api.weather.example.com/current?city={{.city}}"
    headers:
      Authorization: "Bearer {{.env.WEATHER_API_TOKEN}}"
      Accept: "application/json"
    auto_approve: true  # Automatically allow this safe read-only tool
    timeout: 10
    max_response_size: 1048576  # 1MB

  # HTTP tool requiring approval
  - name: send_alert
    type: http
    description: "Send alert notification to team"
    method: POST
    url: "https://alerts.example.com/send"
    headers:
      Authorization: "Bearer {{.env.ALERTS_TOKEN}}"
      Content-Type: "application/json"
    auto_approve: false  # Requires user approval
    timeout: 5

  # Script tool for data processing
  - name: process_data
    type: script
    description: "Process data with custom Python script"
    command: "./scripts/process.py"
    auto_approve: true
    timeout: 30
    max_response_size: 1048576

  # Script tool requiring approval (can modify files)
  - name: update_database
    type: script
    description: "Update local database with processed results"
    command: "./scripts/update_db.sh"
    auto_approve: false  # Requires approval for write operations
    timeout: 15

steps:
  # Step 1: Fetch weather data
  - id: fetch_weather
    type: llm
    model: fast
    system: "You are a helpful assistant that can fetch weather data."
    prompt: "Get the current weather for {{.city}}"
    functions: [get_weather]  # Only allow weather API function (renamed from 'tools')
    # LLM can call get_weather function during execution
    # Result available in step context

  # Step 2: Analyze weather (no functions)
  - id: analyze
    type: llm
    model: balanced
    prompt: |
      Analyze this weather data and determine if conditions are suitable for outdoor activities:
      {{.steps.fetch_weather.response}}

      Provide a brief recommendation.

  # Step 3: Process data with script (if needed)
  - id: process
    type: llm
    model: fast
    system: "You can process data using the process_data script function."
    prompt: |
      Process this weather analysis into a structured format:
      {{.steps.analyze.response}}
    functions: [process_data]

  # Step 4: Send alert if conditions are severe (requires approval)
  - id: alert
    type: llm
    model: fast
    system: "You can send alerts if weather conditions are severe."
    prompt: |
      Based on this analysis:
      {{.steps.analyze.response}}

      If conditions are severe (storms, extreme temperatures, etc.), send an alert to the team.
      Otherwise, skip sending an alert.
    functions: [send_alert]  # Requires user approval when called

  # Step 5: Summary
  - id: summary
    type: llm
    model: balanced
    prompt: |
      Summarize the weather check:
      - Location: {{.city}}
      - Conditions: {{.steps.analyze.response}}
      - Alerts sent: {{.steps.alert.response}}

      Provide a concise summary for the user.

inputs:
  - name: city
    type: string
    required: true
    description: "City name to check weather for"

outputs:
  - name: summary
    type: string
    value: "$.steps.summary.response"
    description: "Weather check summary"
