name: pantry-aware-meals
description: Generate meal plans based on available ingredients

inputs:
  - name: days
    type: string
    required: false
    default: "3"
    description: Number of days to plan
  - name: pantry_file
    type: string
    required: false
    default: "pantry.txt"
    description: Path to pantry inventory file

steps:
  # Read pantry inventory
  - id: read_pantry
    file.read: "{{.pantry_file}}"

  # Generate meal plan using pantry data
  - id: plan
    type: llm
    model: balanced
    prompt: |
      Create a {{.days}}-day meal plan using primarily these available ingredients:

      PANTRY INVENTORY:
      {{.steps.read_pantry.response}}

      Requirements:
      - Prioritize using ingredients from the pantry
      - Only suggest purchasing fresh items (produce, dairy, meat)
      - Include breakfast, lunch, and dinner for each day
      - Note which pantry items each meal uses

      Format as a daily plan with a shopping list for items not in pantry.

  # Critique and improve
  - id: refine
    type: loop
    max_iterations: 2
    until: 'steps.critique.response contains "APPROVED"'
    steps:
      - id: critique
        type: llm
        model: balanced
        prompt: |
          Review this meal plan for pantry efficiency:

          AVAILABLE INGREDIENTS:
          {{.steps.read_pantry.response}}

          MEAL PLAN:
          {{.steps.plan.response}}

          Check:
          1. Are pantry ingredients well-utilized?
          2. Is the shopping list minimal?
          3. Are meals practical and balanced?

          If good, respond with: APPROVED
          Otherwise, suggest specific improvements.

      - id: improve
        type: llm
        model: balanced
        when: 'not (steps.critique.response contains "APPROVED")'
        prompt: |
          Improve this meal plan based on feedback:

          PANTRY: {{.steps.read_pantry.response}}

          CURRENT PLAN:
          {{.steps.plan.response}}

          FEEDBACK: {{.steps.critique.response}}

          Create an improved version that better uses pantry ingredients.

