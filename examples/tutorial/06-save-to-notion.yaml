# yaml-language-server: $schema=../../schemas/workflow.schema.json
name: save-to-notion
description: Generate a meal plan and save it to Notion

inputs:
  - name: pantry_file
    type: string
    default: "pantry.txt"
    description: Path to pantry inventory file

  - name: notion_database_id
    type: string
    description: Notion database ID for meal plans

steps:
  - id: read_pantry
    name: Read Pantry Inventory
    file.read: "{{.inputs.pantry_file}}"

  - id: plan_week
    name: Generate Weekly Plan
    type: llm
    model: fast
    prompt: |
      Available ingredients:
      {{.steps.read_pantry.content}}

      Generate a balanced meal plan for Monday through Sunday.
      For each day, create breakfast, lunch, and dinner.

      Return JSON:
      {
        "monday": {"breakfast": "...", "lunch": "...", "dinner": "..."},
        "tuesday": {"breakfast": "...", "lunch": "...", "dinner": "..."},
        "wednesday": {"breakfast": "...", "lunch": "...", "dinner": "..."},
        "thursday": {"breakfast": "...", "lunch": "...", "dinner": "..."},
        "friday": {"breakfast": "...", "lunch": "...", "dinner": "..."},
        "saturday": {"breakfast": "...", "lunch": "...", "dinner": "..."},
        "sunday": {"breakfast": "...", "lunch": "...", "dinner": "..."}
      }

  - id: save_plan
    name: Save to Notion
    http.post:
      url: https://api.notion.com/v1/pages
      headers:
        Authorization: "Bearer {{env.NOTION_TOKEN}}"
        Notion-Version: "2022-06-28"
        Content-Type: application/json
      body:
        parent:
          database_id: "{{.inputs.notion_database_id}}"
        properties:
          Name:
            title:
              - text:
                  content: "Weekly Meal Plan"
          Content:
            rich_text:
              - text:
                  content: "{{.steps.plan_week.response}}"

outputs:
  - name: weekly_plan
    type: string
    value: "{{.steps.plan_week.response}}"
    description: Complete weekly meal plan
