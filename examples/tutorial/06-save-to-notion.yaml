name: save-to-notion
inputs:
  pantryFile:
    type: string
    default: "pantry.txt"
  notionDatabaseId:
    type: string
    description: Notion database ID
steps:
  - id: readPantry
    file:
      action: read
      path: ${inputs.pantryFile}
  - id: planWeek
    foreach:
      items:
        - Monday
        - Tuesday
        - Wednesday
        - Thursday
        - Friday
        - Saturday
        - Sunday
      steps:
        - id: dailyMeals
          llm:
            model: claude-3-5-sonnet-20241022
            prompt: |
              Available ingredients:
              ${steps.readPantry.output}

              Generate meals for ${item}.
              Previous days: ${steps.planWeek.outputs}

              Return JSON:
              {
                "day": "${item}",
                "breakfast": {"name": "...", "ingredients": [...]},
                "lunch": {"name": "...", "ingredients": [...]},
                "dinner": {"name": "...", "ingredients": [...]}
              }
  - id: saveToNotion
    foreach:
      items: ${steps.planWeek.outputs}
      steps:
        - id: createPage
          http:
            method: POST
            url: https://api.notion.com/v1/pages
            headers:
              Authorization: "Bearer ${NOTION_TOKEN}"
              Notion-Version: "2022-06-28"
              Content-Type: application/json
            body:
              parent:
                database_id: ${inputs.notionDatabaseId}
              properties:
                Day:
                  title:
                    - text:
                        content: ${item.day}
                Breakfast:
                  rich_text:
                    - text:
                        content: ${item.breakfast.name}
                Lunch:
                  rich_text:
                    - text:
                        content: ${item.lunch.name}
                Dinner:
                  rich_text:
                    - text:
                        content: ${item.dinner.name}
outputs:
  weeklyPlan: ${steps.planWeek.outputs}
